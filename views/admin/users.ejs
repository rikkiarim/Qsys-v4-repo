<% layout('layouts/main') %>
<section class="admin-content">
  <h1 class="page-title">User Management</h1>

  <!-- Toasts -->
  <% if (typeof success !== "undefined") { %>
    <div class="toast toast-success"><%= success %></div>
  <% } %>
  <% if (typeof error !== "undefined") { %>
    <div class="toast toast-error"><%= error %></div>
  <% } %>

  <div class="flex-container" style="gap:2rem;flex-wrap:wrap;">
    <!-- Add User Form -->
    <div class="card" style="min-width:320px;flex:1 1 340px;max-width:380px;background:#D6EFD8;">
      <h2 class="card-title">Add New User</h2>
      <form method="POST" action="/admin/users/add" class="form-column">
        <div class="form-group">
          <label for="name">Full Name</label>
          <input type="text" id="name" name="name" required autocomplete="off" />
        </div>
        <div class="form-group">
          <label for="email">Email Address</label>
          <input type="email" id="email" name="email" required autocomplete="off" />
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" name="password" minlength="6" required autocomplete="new-password" />
        </div>
        <div class="form-group">
          <label for="role">Role</label>
          <select id="role" name="role" required>
            <option value="" disabled selected>Select Role</option>
            <option value="admin">Admin</option>
            <option value="staff">Staff</option>
          </select>
        </div>
        <div class="form-group">
          <label for="branch">Branch</label>
          <select id="branch" name="branch" required>
            <option value="" disabled selected>Select Branch</option>
            <% branches.forEach(branch => { %>
              <option value="<%= branch.code %>"><%= branch.name %></option>
            <% }) %>
          </select>
        </div>
        <button type="submit" class="btn btn-green" style="margin-top:1.5rem;width:100%;">Add User</button>
      </form>
    </div>

    <!-- User List Table -->
    <div class="card" style="flex:2 1 500px;background:#F6FBF5;">
      <h2 class="card-title">All Users</h2>
      <div class="table-responsive">
        <table class="data-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Role</th>
              <th>Branch</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if (users.length === 0) { %>
              <tr>
                <td colspan="5" style="text-align:center;">No users found.</td>
              </tr>
            <% } else { %>
              <% users.forEach(user => { %>
                <tr>
                  <td><%= user.name %></td>
                  <td><%= user.email %></td>
                  <td style="text-transform:capitalize;"><%= user.role %></td>
                  <td>
                    <% let branch = branches.find(b => b.code === user.branch); %>
                    <%= branch ? branch.name : user.branch %>
                  </td>
                  <td>
                    <form method="POST" action="/admin/users/delete/<%= user.uid %>" style="display:inline;">
                      <button type="submit" class="btn btn-red btn-small" onclick="return confirm('Are you sure you want to delete this user?');">
                        Delete
                      </button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<!-- QSys admin user styles -->
<style>
.admin-content {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2.5rem 1.5rem;
}
.page-title {
  font-family: 'Raleway', 'Montserrat', sans-serif;
  color: #1A5319;
  font-size: 2.2rem;
  margin-bottom: 1.8rem;
  letter-spacing: 1px;
  text-align: left;
}
.flex-container {
  display: flex;
  gap: 2.5rem;
  align-items: flex-start;
  justify-content: flex-start;
}
.card {
  border-radius: 1.4rem;
  box-shadow: 0 2px 16px 0 rgba(24,48,24,0.07);
  padding: 2rem 1.6rem 1.6rem 1.6rem;
}
.card-title {
  font-size: 1.25rem;
  font-weight: 700;
  color: #508D4E;
  margin-bottom: 1.4rem;
  letter-spacing: 0.5px;
}
.form-column .form-group {
  margin-bottom: 1.1rem;
}
.form-column label {
  font-size: 1rem;
  font-weight: 600;
  color: #1A5319;
  margin-bottom: 0.3rem;
  display: block;
}
.form-column input, .form-column select {
  width: 100%;
  padding: 0.62rem 0.75rem;
  border-radius: 0.6rem;
  border: 1px solid #B0C5B6;
  background: #fff;
  font-size: 1rem;
  margin-top: 0.1rem;
}
.btn {
  font-family: 'Montserrat', 'Raleway', sans-serif;
  font-size: 1rem;
  border: none;
  border-radius: 0.6rem;
  padding: 0.6rem 1.2rem;
  cursor: pointer;
  font-weight: 700;
  transition: background 0.18s;
}
.btn-green {
  background: #508D4E;
  color: #fff;
}
.btn-green:hover, .btn-green:focus { background: #1A5319; }
.btn-red {
  background: #c2432c;
  color: #fff;
}
.btn-red:hover, .btn-red:focus { background: #99251a; }
.btn-small { padding: 0.35rem 0.95rem; font-size: 0.97rem; }
.data-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 0.7rem;
}
.data-table th, .data-table td {
  padding: 0.85rem 0.8rem;
  text-align: left;
  font-size: 1rem;
  border-bottom: 1px solid #D6EFD8;
}
.data-table th {
  background: #D6EFD8;
  color: #1A5319;
  font-weight: 700;
}
.data-table tr:last-child td {
  border-bottom: none;
}
.toast {
  padding: 0.7rem 1.2rem;
  border-radius: 0.8rem;
  margin-bottom: 1.3rem;
  font-weight: 600;
  font-size: 1.06rem;
}
.toast-success { background: #D6EFD8; color: #1A5319; }
.toast-error { background: #FFD2D2; color: #8B2727; }
@media (max-width: 1024px) {
  .flex-container { flex-direction: column; }
  .card { width: 100%; min-width: unset; }
}
@media (max-width: 600px) {
  .admin-content { padding: 1.3rem 0.3rem; }
  .card { padding: 1.2rem 0.7rem; }
  .page-title { font-size: 1.33rem; }
}
</style>
